<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Percentil de Pressão Arterial Pediátrica com Tabela Completa OMS</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    select, input { padding: 5px; margin-top: 5px; width: 100%; box-sizing: border-box; }
    .idade-box { display: flex; gap: 10px; }
    button { margin-top: 15px; padding: 8px; width: 100%; }
    .resultado { margin-top: 20px; font-weight: bold; background: #f1f1f1; padding: 10px; border-radius: 5px; }
    .alerta { color: #b00; font-weight: bold; }
    .class-normal { color: green; font-weight: bold; }
    .class-limite { color: orange; font-weight: bold; }
    .class-hipertensao { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>Calculadora de Percentil - PA Pediátrica (OMS Completa + Classificação SBP)</h1>

<label>Sexo:
    <select id="sexo">
        <option value="M">Masculino</option>
        <option value="F">Feminino</option>
    </select>
</label>

<label>Idade:</label>
<div class="idade-box">
    <input type="number" id="idadeAnos" placeholder="Anos" min="0" max="19">
    <input type="number" id="idadeMeses" placeholder="Meses" min="0" max="11">
</div>

<label>Estatura (cm): 
    <input type="number" id="estatura" step="0.1" min="40" max="210">
</label>

<label>PA Sistólica (mmHg): <input type="number" id="pas" step="0.1" min="40" max="200"></label>
<label>PA Diastólica (mmHg): <input type="number" id="pad" step="0.1" min="20" max="150"></label>

<button onclick="calcularPercentis()">Calcular</button>

<div class="resultado" id="resultado"></div>

<script>
// Tabela completa de comprimento/altura OMS - Meninos (meses)
const tabelaBoys = {
0: [49.8842,1.8931],1: [54.7244,1.9465],2: [58.4249,2.0005],3: [61.4292,2.0444],4: [63.886,2.0808],
5: [65.9026,2.1115],6: [67.6236,2.1403],7: [69.1645,2.1711],8: [70.5994,2.2055],9: [71.9687,2.2433],
10: [73.2812,2.2849],11: [74.5388,2.3293],12: [75.7488,2.3762],13: [76.9186,2.426],14: [78.0497,2.4773],
15: [79.1458,2.5303],16: [80.2113,2.5844],17: [81.2487,2.6406],18: [82.2587,2.6973],19: [83.2418,2.7553],
20: [84.1996,2.814],21: [85.1348,2.8742],22: [86.0477,2.9342],23: [86.941,2.9951],24: [87.8161,3.0551],
25: [87.972,3.116],26: [88.8065,3.1757],27: [89.6197,3.2353],28: [90.412,3.2928],29: [91.1828,3.3501],
30: [91.9327,3.4052],31: [92.6631,3.4591],32: [93.3753,3.5118],33: [94.0711,3.5625],34: [94.7532,3.612],
35: [95.4236,3.6604],36: [96.0835,3.7069],37: [96.7337,3.7523],38: [97.3749,3.7976],39: [98.0073,3.8409],
40: [98.631,3.8831],41: [99.2459,3.9242],42: [99.8515,3.9651],43: [100.4485,4.0039],44: [101.0374,4.0435],
45: [101.6186,4.081],46: [102.1933,4.1194],47: [102.7625,4.1567],48: [103.3273,4.1941],49: [103.8886,4.2314],
50: [104.4473,4.2677],51: [105.0041,4.3052],52: [105.5596,4.3417],53: [106.1138,4.3783],54: [106.6668,4.4149],
55: [107.2188,4.4517],56: [107.7697,4.4886],57: [108.3198,4.5245],58: [108.8689,4.5616],59: [109.417,4.5977],
60: [109.9638,4.6339],61: [110.2647,4.5914],62: [110.8006,4.6226],63: [111.3338,4.6538],64: [111.8636,4.6837],
65: [112.3895,4.7147],66: [112.911,4.7456],67: [113.428,4.7765],68: [113.941,4.806],69: [114.45,4.8367],
70: [114.9547,4.8672],71: [115.4549,4.8964],72: [115.9509,4.9268],73: [116.4432,4.957],74: [116.9325,4.986],
75: [117.4196,5.0162],76: [117.9046,5.0463],77: [118.388,5.0753],78: [118.87,5.1055],79: [119.3508,5.1357],
80: [119.8303,5.1659],81: [120.3085,5.1949],82: [120.7853,5.2252],83: [121.2604,5.2554],84: [121.7338,5.2857],
85: [122.2053,5.3159],86: [122.675,5.3462],87: [123.1429,5.3764],88: [123.6092,5.4067],89: [124.0736,5.4369],
90: [124.5361,5.4671],91: [124.9964,5.4973],92: [125.4545,5.5275],93: [125.9104,5.5577],94: [126.364,5.5878],
95: [126.8156,5.6179],96: [127.2651,5.648],97: [127.7129,5.6781],98: [128.159,5.7082],99: [128.6034,5.7383],
100: [129.0466,5.7684],101: [129.4887,5.7985],102: [129.93,5.83],103: [130.3705,5.8602],104: [130.8103,5.8904],
105: [131.2495,5.9207],106: [131.6884,5.951],107: [132.1269,5.9814],108: [132.5652,6.0118],109: [133.0031,6.0423],
110: [133.4404,6.0729],111: [133.877,6.1035],112: [134.313,6.1327],113: [134.7483,6.1634],114: [135.1829,6.1941],
115: [135.6168,6.2235],116: [136.0501,6.2542],117: [136.4829,6.2837],118: [136.9153,6.3145],119: [137.3474,6.3441],
120: [137.7795,6.3737],121: [138.2119,6.4034],122: [138.6452,6.4331],123: [139.0797,6.463],124: [139.5158,6.4931],
125: [139.954,6.5233],126: [140.3948,6.5522],127: [140.8387,6.5828],128: [141.2859,6.6122],129: [141.7368,6.6418],
130: [142.1916,6.6716],131: [142.6501,6.7017],132: [143.1126,6.7306],133: [143.5795,6.7612],134: [144.0511,6.7906],
135: [144.5276,6.8203],136: [145.0093,6.8488],137: [145.4964,6.8791],138: [145.9891,6.9082],139: [146.4878,6.9377],
140: [146.9927,6.9675],141: [147.5041,6.9976],142: [148.0224,7.0266],143: [148.5478,7.056],144: [149.0807,7.0858],
145: [149.6212,7.1145],146: [150.1694,7.1451],147: [150.7256,7.173],148: [151.2899,7.2029],149: [151.8623,7.2317],
150: [152.4425,7.2608],151: [153.0298,7.2888],152: [153.6234,7.3186],153: [154.2223,7.3456],154: [154.8258,7.3744],
155: [155.4329,7.4017],156: [156.0426,7.4276],157: [156.6539,7.4536],158: [157.266,7.4796],159: [157.8775,7.5055],
160: [158.4871,7.5297],161: [159.0937,7.5522],162: [159.6962,7.576],163: [160.2939,7.5979],164: [160.8861,7.618],
165: [161.472,7.6376],166: [162.0505,7.6569],167: [162.6207,7.6757],168: [163.1816,7.6924],169: [163.7321,7.7069],
170: [164.2717,7.7224],171: [164.7994,7.7357],172: [165.3145,7.7483],173: [165.8165,7.7586],174: [166.305,7.7681],
175: [166.7799,7.7769],176: [167.2415,7.7851],177: [167.6899,7.7909],178: [168.1255,7.796],179: [168.5482,7.8004],
180: [168.958,7.8042],181: [169.3549,7.8056],182: [169.7389,7.8063],183: [170.1099,7.8063],184: [170.468,7.8057],
185: [170.8136,7.8045],186: [171.1468,7.8026],187: [171.468,7.7984],188: [171.7773,7.7953],189: [172.0748,7.7898],
190: [172.3606,7.7838],191: [172.6345,7.7789],192: [172.8967,7.7717],193: [173.147,7.7639],194: [173.3856,7.7555],
195: [173.6126,7.7466],196: [173.828,7.7371],197: [174.0321,7.727],198: [174.2251,7.7164],199: [174.4071,7.7053],
200: [174.5784,7.6937],201: [174.7392,7.6815],202: [174.8896,7.6689],203: [175.0301,7.6576],204: [175.1609,7.644],
205: [175.2824,7.63],206: [175.3951,7.6174],207: [175.4995,7.6026],208: [175.5959,7.5893],209: [175.685,7.5738],
210: [175.7672,7.5597],211: [175.8432,7.5454],212: [175.9133,7.5308],213: [175.9781,7.516],214: [176.038,7.501],
215: [176.0935,7.4857],216: [176.1449,7.4703],217: [176.1925,7.4565],218: [176.2368,7.4407],219: [176.2779,7.4266],
220: [176.3162,7.4123],221: [176.3518,7.398],222: [176.3851,7.3817],223: [176.4162,7.3689],224: [176.4453,7.3542],
225: [176.4724,7.3395],226: [176.4976,7.3247],227: [176.5211,7.3115],228: [176.5432,7.2983]
};

// Tabela OMS completa - Meninas
const tabelaGirls = {
0: [49.1477,1.8627],1: [53.6872,1.9542],2: [57.0673,2.0362],3: [59.8029,2.1051],4: [62.0899,2.1645],
5: [64.0301,2.2174],6: [65.7311,2.2664],7: [67.2873,2.3154],8: [68.7498,2.365],9: [70.1435,2.4157],
10: [71.4818,2.4676],11: [72.771,2.5208],12: [74.015,2.575],13: [75.2176,2.6296],14: [76.3817,2.6841],
15: [77.5099,2.7392],16: [78.6055,2.7944],17: [79.671,2.849],18: [80.7079,2.9039],19: [81.7182,2.9582],
20: [82.7036,3.0129],21: [83.6654,3.0672],22: [84.604,3.1202],23: [85.5202,3.1737],24: [86.4153,3.2267],
25: [86.5904,3.2783],26: [87.4462,3.33],27: [88.283,3.3812],28: [89.1004,3.4313],29: [89.8991,3.4809],
30: [90.6797,3.5302],31: [91.443,3.5782],32: [92.1906,3.6259],33: [92.9239,3.6724],34: [93.6444,3.7186],
35: [94.3533,3.7638],36: [95.0515,3.8078],37: [95.7399,3.8526],38: [96.4187,3.8963],39: [97.0885,3.9389],
40: [97.7493,3.9813],41: [98.4015,4.0236],42: [99.0448,4.0658],43: [99.6795,4.1068],44: [100.3058,4.1476],
45: [100.9238,4.1883],46: [101.5337,4.2279],47: [102.136,4.2683],48: [102.7312,4.3075],49: [103.3197,4.3456],
50: [103.9021,4.3847],51: [104.4786,4.4226],52: [105.0494,4.4604],53: [105.6148,4.4981],54: [106.1748,4.5358],
55: [106.7295,4.5734],56: [107.2788,4.6108],57: [107.8227,4.6472],58: [108.3613,4.6834],59: [108.8948,4.7195],
60: [109.4233,4.7566],61: [109.6016,4.7731],62: [110.1258,4.8059],63: [110.6451,4.8385],64: [111.1596,4.871],
65: [111.6696,4.9023],66: [112.1753,4.9346],67: [112.6767,4.9657],68: [113.174,4.9966],69: [113.6672,5.0275],
70: [114.1565,5.0583],71: [114.6421,5.089],72: [115.1244,5.1196],73: [115.6039,5.149],74: [116.0812,5.1784],
75: [116.5568,5.2089],76: [117.0311,5.2371],77: [117.5044,5.2665],78: [117.9769,5.296],79: [118.4489,5.3243],
80: [118.9208,5.3538],81: [119.3926,5.3822],82: [119.8648,5.4107],83: [120.3374,5.4393],84: [120.8105,5.4667],
85: [121.2843,5.4954],86: [121.7587,5.523],87: [122.2338,5.5519],88: [122.7098,5.5796],89: [123.1868,5.6062],
90: [123.6646,5.6342],91: [124.1435,5.6622],92: [124.6234,5.6891],93: [125.1045,5.716],94: [125.5869,5.7431],
95: [126.0706,5.7703],96: [126.5558,5.7975],97: [127.0424,5.8249],98: [127.5304,5.8511],99: [128.0199,5.8774],
100: [128.5109,5.9038],101: [129.0035,5.9303],102: [129.4975,5.9569],103: [129.9932,5.9823],104: [130.4904,6.0078],
105: [130.9891,6.0347],106: [131.4895,6.059],107: [131.9912,6.0848],108: [132.4944,6.1106],109: [132.9989,6.1352],
110: [133.5046,6.1599],111: [134.0118,6.1846],112: [134.5202,6.2095],113: [135.0299,6.233],114: [135.541,6.2579],
115: [136.0533,6.2816],116: [136.567,6.3039],117: [137.0821,6.3277],118: [137.5987,6.3516],119: [138.1167,6.3741],
120: [138.6363,6.3967],121: [139.1575,6.4179],122: [139.6803,6.4407],123: [140.2049,6.462],124: [140.7313,6.4835],
125: [141.2594,6.505],126: [141.7892,6.5266],127: [142.3206,6.5467],128: [142.8534,6.567],129: [143.3874,6.5872],
130: [143.9222,6.6075],131: [144.4575,6.6277],132: [144.9929,6.6465],133: [145.528,6.6652],134: [146.0622,6.6838],
135: [146.5951,6.7009],136: [147.1262,6.7193],137: [147.6548,6.736],138: [148.1804,6.7526],139: [148.7023,6.7689],
140: [149.2197,6.7835],141: [149.7322,6.7993],142: [150.239,6.8133],143: [150.7394,6.827],144: [151.2327,6.8403],
145: [151.7182,6.8516],146: [152.1951,6.864],147: [152.6628,6.8744],148: [153.1206,6.8858],149: [153.5678,6.8952],
150: [154.0041,6.904],151: [154.429,6.9122],152: [154.8423,6.9184],153: [155.2437,6.9254],154: [155.633,6.9319],
155: [156.0101,6.9362],156: [156.3748,6.9415],157: [156.7269,6.9446],158: [157.0666,6.9471],159: [157.3936,6.9489],
160: [157.7082,6.9518],161: [158.0102,6.9524],162: [158.2997,6.9525],163: [158.5771,6.952],164: [158.8425,6.9509],
165: [159.0961,6.9509],166: [159.3382,6.9487],167: [159.5691,6.946],168: [159.789,6.9428],169: [159.9983,6.9391],
170: [160.1971,6.9365],171: [160.3857,6.9319],172: [160.5643,6.9267],173: [160.7332,6.9228],174: [160.8927,6.9168],
175: [161.043,6.912],176: [161.1845,6.9051],177: [161.3176,6.8996],178: [161.4425,6.8936],179: [161.5596,6.8873],
180: [161.6692,6.879],181: [161.7717,6.8721],182: [161.8673,6.8648],183: [161.9564,6.8589],184: [162.0393,6.851],
185: [162.1164,6.8429],186: [162.188,6.8346],187: [162.2542,6.8277],188: [162.3154,6.8189],189: [162.3719,6.8115],
190: [162.4239,6.8039],191: [162.4717,6.7946],192: [162.5156,6.7867],193: [162.556,6.7786],194: [162.5933,6.7704],
195: [162.6276,6.7621],196: [162.6594,6.7536],197: [162.689,6.7467],198: [162.7165,6.7381],199: [162.7425,6.731],
200: [162.767,6.7223],201: [162.7904,6.7151],202: [162.8126,6.7063],203: [162.834,6.699],204: [162.8545,6.6917],
205: [162.8743,6.6844],206: [162.8935,6.677],207: [162.912,6.6696],208: [162.93,6.6622],209: [162.9476,6.6548],
210: [162.9649,6.649],211: [162.9817,6.6415],212: [162.9983,6.6357],213: [163.0144,6.6282],214: [163.03,6.6223],
215: [163.0451,6.6164],216: [163.0595,6.6088],217: [163.0733,6.6028],218: [163.0862,6.5968],219: [163.0982,6.5908],
220: [163.1092,6.5847],221: [163.1192,6.5802],222: [163.1279,6.5741],223: [163.1355,6.5678],224: [163.1418,6.5632],
225: [163.1469,6.5569],226: [163.1508,6.5521],227: [163.1534,6.5457],228: [163.1548,6.5409]
};

// Função interpolação entre meses da tabela OMS (meninos ou meninas)
function getRefHeightMeanSD(years, months, sexo){
    const ageMonths = years * 12 + months;
    const tabela = sexo === "M" ? tabelaBoys : tabelaGirls;
    const keys = Object.keys(tabela).map(k => Number(k)).sort((a,b)=>a-b);
    let low = keys[0];
    let high = keys[keys.length-1];
    for (let k of keys){
        if(k <= ageMonths) low = k;
        if(k >= ageMonths){
            high = k;
            break;
        }
    }
    if(low === high) return tabela[low];
    const [meanLow, sdLow] = tabela[low];
    const [meanHigh, sdHigh] = tabela[high];
    const frac = (ageMonths - low) / (high - low);
    return [meanLow + frac * (meanHigh - meanLow), sdLow + frac * (sdHigh - sdLow)];
}

// Coeficientes para PA (mesmos já detalhados)
const coeficientes = {
    M: {
        SBP: { alpha: 102.19768, beta1: 1.82416, beta2: 0.12794, beta3: -0.00235, beta4: 0.00146,
            gamma1: 2.73157, gamma2: 0.21844, gamma3: -0.00135, gamma4: -0.01014, sigma: 10.7128 },
        DBP: { alpha: 61.10206, beta1: 0.93801, beta2: 0.15915, beta3: -0.00412, beta4: 0.00092,
            gamma1: 1.15633, gamma2: 0.06492, gamma3: -0.00107, gamma4: -0.00218, sigma: 8.6741 }
    },
    F: {
        SBP: { alpha: 102.01027, beta1: 1.91542, beta2: 0.02135, beta3: 0.00096, beta4: 0.00105,
            gamma1: 2.77393, gamma2: 0.08445, gamma3: 0.00123, gamma4: -0.00944, sigma: 10.4855 },
        DBP: { alpha: 60.57968, beta1: 1.07542, beta2: 0.07624, beta3: -0.00199, beta4: 0.00064,
            gamma1: 1.19016, gamma2: 0.04356, gamma3: -0.00012, gamma4: -0.00170, sigma: 8.4301 }
    }
};

// Função cálculo principal
function calcularPercentis(){
    const sexo = document.getElementById('sexo').value;
    const anos = parseInt(document.getElementById('idadeAnos').value) || 0;
    const meses = parseInt(document.getElementById('idadeMeses').value) || 0;
    const estatura = parseFloat(document.getElementById('estatura').value);
    const pas = parseFloat(document.getElementById('pas').value);
    const pad = parseFloat(document.getElementById('pad').value);
    const resDiv = document.getElementById('resultado');

    // Validação
    if(isNaN(estatura) || isNaN(pas) || isNaN(pad)){
        resDiv.innerHTML = "<span class='alerta'>Preencha todos os campos corretamente.</span>";
        return;
    }
    if(anos < 0 || anos > 19){
        resDiv.innerHTML = "<span class='alerta'>Idade deve ser entre 0 e 19 anos.</span>";
        return;
    }
    if(meses < 0 || meses > 11){
        resDiv.innerHTML = "<span class='alerta'>Meses devem ser entre 0 e 11.</span>";
        return;
    }

    // Média e DP da estatura, interpolando
    const [mediaHt, sdHt] = getRefHeightMeanSD(anos, meses, sexo);
    if(!mediaHt || !sdHt){
        resDiv.innerHTML = "<span class='alerta'>Referência não disponível para essa idade.</span>";
        return;
    }

    // Calcular Z da estatura
    const zht = (estatura - mediaHt) / sdHt;
    const idadeDecimal = anos + meses / 12;

    // Calcular percentis para PAS e PAD
    const resPAS = calcularIndicadoresPA(sexo, "SBP", idadeDecimal, zht, pas);
    const resPAD = calcularIndicadoresPA(sexo, "DBP", idadeDecimal, zht, pad);

    // Classificação da pressão conforme Sociedade Brasileira de Pediatria
    const classPAS = classificarPA(resPAS.percentil);
    const classPAD = classificarPA(resPAD.percentil);

    resDiv.innerHTML =
        `<b>Z da estatura:</b> ${zht.toFixed(2).replace('.',',')} (média: ${mediaHt.toFixed(1).replace('.',',')} cm; DP: ${sdHt.toFixed(2).replace('.',',')} cm)<br><br>`+
        `<b>PA Sistólica (PAS):</b> Média: ${resPAS.media} mmHg | Z-score: ${resPAS.zscore} | Percentil: ${resPAS.percentil}% <span class="${classPAS.className}">(${classPAS.label})</span><br><br>`+
        `<b>PA Diastólica (PAD):</b> Média: ${resPAD.media} mmHg | Z-score: ${resPAD.zscore} | Percentil: ${resPAD.percentil}% <span class="${classPAD.className}">(${classPAD.label})</span>`;

}

// Calculo percentis e z-score
function calcularIndicadoresPA(sexo, tipo, idade, zht, pa){
    const c = coeficientes[sexo][tipo];
    const media = c.alpha + c.beta1*idade + c.beta2*idade**2 + c.beta3*idade**3 + c.beta4*idade**4
        + zht*(c.gamma1 + c.gamma2*idade + c.gamma3*idade**2 + c.gamma4*idade**3);
    const zscore = (pa - media)/c.sigma;
    const percentil = (0.5 * (1 + erf(zscore/Math.SQRT2))) * 100;
    return {
        media: media.toFixed(1).replace('.',','),
        zscore: zscore.toFixed(2).replace('.',','),
        percentil: percentil.toFixed(1).replace('.',',')
    };
}

// Classificação conforme SBC - Sociedade Brasileira de Pediatria
function classificarPA(percentilStr){
    const p = parseFloat(percentilStr.replace(',', '.'));
    if(p < 90) return {label: "Normal", className: "class-normal"};
    if(p < 95) return {label: "Limítrofe", className: "class-limite"};
    return {label: "Hipertensão", className: "class-hipertensao"};
}

// Função erro para distribuição normal cumulativa
function erf(x){
    const sign = x >= 0 ? 1 : -1;
    x = Math.abs(x);
    const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
    const t=1/(1+p*x);
    const y=1 - ((((a5*t+a4)*t + a3)*t + a2)*t + a1)*t*Math.exp(-x*x);
    return sign*y;
}
</script>

</body>
</html>
