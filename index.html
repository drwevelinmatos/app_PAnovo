<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Percentil de Pressão Arterial Pediátrica</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    select, input { padding: 5px; margin-top: 5px; width: 100%; box-sizing: border-box; }
    .idade-box { display: flex; gap: 10px; }
    button { margin-top: 15px; padding: 8px; width: 100%; }
    .resultado { margin-top: 20px; font-weight: bold; background: #f1f1f1; padding: 10px; border-radius: 5px; }
    .alerta { color: #b00; font-weight: bold; }
</style>
</head>
<body>

<h1>Calculadora de Percentil - PA Pediátrica (OMS)</h1>

<label>Sexo:
    <select id="sexo">
        <option value="M">Masculino</option>
        <option value="F">Feminino</option>
    </select>
</label>

<label>Idade:</label>
<div class="idade-box">
    <input type="number" id="idadeAnos" placeholder="Anos" min="0" max="19">
    <input type="number" id="idadeMeses" placeholder="Meses" min="0" max="11">
</div>

<label>Estatura (cm): 
    <input type="number" id="estatura" step="0.1" min="40" max="210">
</label>

<label>PA Sistólica (mmHg): 
    <input type="number" id="pas" step="0.1" min="40" max="200">
</label>
<label>PA Diastólica (mmHg): 
    <input type="number" id="pad" step="0.1" min="20" max="150">
</label>

<button onclick="calcularPercentis()">Calcular</button>

<div class="resultado" id="resultado"></div>

<script>
// --- Tabelas M e F da OMS (trechos extraídos, acrescente o restante conforme seus anexos)
const tabelaBoys = {
    0:[49.8842,1.8931], 1:[54.7244,1.9465], 2:[58.4249,2.0005], 3:[61.4292,2.0444],
    4:[63.8860,2.0808], 5:[65.9026,2.1115], 6:[67.6236,2.1403], 12:[75.7488,2.3762],
    24:[87.8161,3.0551], 36:[96.0835,3.7069], 48:[103.3273,4.1941], 60:[109.9638,4.6339],
    120:[137.7795,6.3737], 180:[168.9580,7.8042], 228:[176.5432,7.2983]
};
const tabelaGirls = {
    0:[49.1477,1.8627], 1:[53.6872,1.9542], 2:[57.0673,2.0362], 3:[59.8029,2.1051],
    4:[62.0899,2.1645], 5:[64.0301,2.2174], 6:[65.7311,2.2664], 12:[74.0150,2.5750],
    24:[86.4153,3.2267], 36:[95.0515,3.8078], 48:[102.7312,4.3075], 60:[109.4233,4.7566],
    120:[138.6363,6.3967], 180:[161.6692,6.8790], 228:[163.1550,6.5409]
};

// --- Retorna média e DP interpolando por idade em meses
function getRefHeightMeanSD(years, months, sexo){
    const idadeMeses = years*12 + months;
    const tabela = sexo==="M" ? tabelaBoys : tabelaGirls;
    const keys = Object.keys(tabela).map(x=>parseInt(x)).sort((a,b)=>a-b);
    let lower = keys[0], upper = keys[keys.length-1];
    for(let i=0;i<keys.length;i++){
        if(keys[i]<=idadeMeses) lower = keys[i];
        if(keys[i]>=idadeMeses){ upper = keys[i]; break; }
    }
    if(lower===upper) return tabela[lower];
    const [mL, sdL] = tabela[lower];
    const [mU, sdU] = tabela[upper];
    const f = (idadeMeses - lower) / (upper - lower);
    return [mL + f*(mU-mL), sdL + f*(sdU-sdL)];
}

// --- Coeficientes PA
const coeficientes = {
    M: {
        SBP:{ alpha:102.19768,beta1:1.82416,beta2:0.12794,beta3:-0.00235,beta4:0.00146,gamma1:2.73157,gamma2:0.21844,gamma3:-0.00135,gamma4:-0.01014,sigma:10.7128 },
        DBP:{ alpha:61.10206,beta1:0.93801,beta2:0.15915,beta3:-0.00412,beta4:0.00092,gamma1:1.15633,gamma2:0.06492,gamma3:-0.00107,gamma4:-0.00218,sigma:8.6741 }
    },
    F: {
        SBP:{ alpha:102.01027,beta1:1.91542,beta2:0.02135,beta3:0.00096,beta4:0.00105,gamma1:2.77393,gamma2:0.08445,gamma3:0.00123,gamma4:-0.00944,sigma:10.4855 },
        DBP:{ alpha:60.57968,beta1:1.07542,beta2:0.07624,beta3:-0.00199,beta4:0.00064,gamma1:1.19016,gamma2:0.04356,gamma3:-0.00012,gamma4:-0.00170,sigma:8.4301 }
    }
};

// --- Cálculo principal
function calcularPercentis(){
    const sexo = document.getElementById('sexo').value;
    const anos = parseInt(document.getElementById('idadeAnos').value)||0;
    const meses = parseInt(document.getElementById('idadeMeses').value)||0;
    const estatura = parseFloat(document.getElementById('estatura').value);
    const pas = parseFloat(document.getElementById('pas').value);
    const pad = parseFloat(document.getElementById('pad').value);
    const resDiv = document.getElementById('resultado');

    if(isNaN(estatura)||isNaN(pas)||isNaN(pad)){
        resDiv.innerHTML = "<span class='alerta'>Preencha todos os campos.</span>"; return;
    }
    const ref = getRefHeightMeanSD(anos, meses, sexo);
    if(!ref){ resDiv.innerHTML = "<span class='alerta'>Idade fora da faixa da tabela.</span>"; return;}
    const [mediaHt, sdHt] = ref;
    const zht = (estatura-mediaHt)/sdHt;

    const idadeDec = anos + meses/12;
    const sist = calcPA(sexo,"SBP",idadeDec,zht,pas);
    const diast = calcPA(sexo,"DBP",idadeDec,zht,pad);

    resDiv.innerHTML =
    `<b>Z da estatura:</b> ${zht.toFixed(2)} (média: ${mediaHt.toFixed(1)}cm; DP: ${sdHt.toFixed(2)}cm)<br><br>
     <b>PAS:</b> Média ${sist.media} | Z-score ${sist.zscore} | Percentil ${sist.percentil}%<br>
     <b>PAD:</b> Média ${diast.media} | Z-score ${diast.zscore} | Percentil ${diast.percentil}%`;
}

function calcPA(sexo,tipo,idade,zht,pa){
    const c = coeficientes[sexo][tipo];
    const media = c.alpha + c.beta1*idade + c.beta2*idade**2 + c.beta3*idade**3 + c.beta4*idade**4
        + zht*(c.gamma1 + c.gamma2*idade + c.gamma3*idade**2 + c.gamma4*idade**3);
    const zscore = (pa - media)/c.sigma;
    const percentil = (0.5*(1+erf(zscore/Math.SQRT2)))*100;
    return { media: media.toFixed(1), zscore: zscore.toFixed(2), percentil: percentil.toFixed(1) };
}

// Função erro
function erf(x){ const sign=(x>=0)?1:-1; x=Math.abs(x);
 const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
 const t=1/(1+p*x); const y=1-(((((a5*t+a4)*t)+a3)*t+a2)*t+a1)*t*Math.exp(-x*x); return sign*y; }
</script>
</body>
</html>
